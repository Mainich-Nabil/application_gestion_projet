<div class="container mt-4">
  <h2>Gestion des T√¢ches - Projet {{ projectId }}</h2>

  <!-- Messages d'erreur et de succ√®s -->
  <div
    *ngIf="errorMessage"
    class="alert alert-danger alert-dismissible fade show"
    role="alert"
  >
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>

  <div
    *ngIf="successMessage"
    class="alert alert-success alert-dismissible fade show"
    role="alert"
  >
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>

  <!-- Indicateur de chargement -->
  <div
    *ngIf="isLoading"
    class="alert alert-info d-flex align-items-center"
    role="alert"
  >
    <div class="spinner-border spinner-border-sm me-2" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
    Rafra√Æchissement en cours...
  </div>

  <!-- Filtres de recherche -->
  <div class="row mb-3">
    <div class="col-md-4">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Filtrer par statut"
          [(ngModel)]="statusFilter"
          (input)="searchByStatus()"
        />
        <button
          class="btn btn-outline-secondary"
          type="button"
          (click)="searchByStatus()"
        >
          Filtrer
        </button>
      </div>
    </div>
    <div class="col-md-4">
      <div class="input-group">
        <input
          type="text"
          class="form-control"
          placeholder="Rechercher par titre"
          [(ngModel)]="titleSearch"
          (input)="searchByTitle()"
        />
        <button
          class="btn btn-outline-secondary"
          type="button"
          (click)="searchByTitle()"
        >
          Rechercher
        </button>
      </div>
    </div>
    <div class="col-md-4">
      <button class="btn btn-secondary" (click)="resetFilters()">
        R√©initialiser les filtres
      </button>
    </div>
  </div>

  <!-- Formulaire d'ajout/modification -->
  <div class="card mb-4">
    <div class="card-header">
      <h5>
        {{ editTaskId ? 'Modifier la t√¢che' : 'Ajouter une nouvelle t√¢che' }}
      </h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="saveTask($event)">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="title" class="form-label">Titre *</label>
            <input
              type="text"
              id="title"
              class="form-control"
              [(ngModel)]="newTask.title"
              name="title"
              required
              placeholder="Titre de la t√¢che"
            />
          </div>
          <div class="col-md-6">
            <label for="status" class="form-label">Statut *</label>
            <select
              id="status"
              class="form-select"
              [(ngModel)]="newTask.status"
              name="status"
              required
            >
              <option value="">S√©lectionner un statut</option>
              <option value="TODO">√Ä faire</option>
              <option value="IN_PROGRESS">En cours</option>
              <option value="DONE">Termin√©</option>
              <option value="CANCELLED">Annul√©</option>
            </select>
          </div>
        </div>
        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea
            id="description"
            class="form-control"
            [(ngModel)]="newTask.description"
            name="description"
            rows="3"
            placeholder="Description de la t√¢che"
          ></textarea>
        </div>
        <div class="mb-3">
          <label for="dueDate" class="form-label">Date d'√©ch√©ance</label>
          <input
            type="date"
            id="dueDate"
            class="form-control"
            [(ngModel)]="newTask.dueDate"
            name="dueDate"
          />
        </div>
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            {{ editTaskId ? 'Modifier' : 'Ajouter' }}
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancelEdit()"
            *ngIf="editTaskId"
          >
            Annuler
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary"
            (click)="startAdd()"
            *ngIf="!editTaskId"
          >
            Nouveau
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Liste des t√¢ches -->
  <div class="card">
    <div class="card-header">
      <h5>Liste des t√¢ches ({{ tasks.length }})</h5>
    </div>
    <div class="card-body">
      <div *ngIf="tasks.length === 0" class="text-center text-muted py-4">
        <p>Aucune t√¢che trouv√©e pour ce projet.</p>
      </div>

      <div *ngIf="tasks.length > 0" class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID</th>
              <th>Titre</th>
              <th>Description</th>
              <th>Statut</th>
              <th>Date d'√©ch√©ance</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of tasks; trackBy: trackById">
              <td>{{ task.id }}</td>
              <td>{{ task.title }}</td>
              <td>{{ task.description || 'Aucune description' }}</td>
              <td>
                <span
                  class="badge"
                  [class.bg-secondary]="task.status === 'TODO'"
                  [class.bg-warning]="task.status === 'IN_PROGRESS'"
                  [class.bg-success]="task.status === 'DONE'"
                  [class.bg-danger]="task.status === 'CANCELLED'"
                >
                  {{ task.status }}
                </span>
              </td>
              <td>{{ task.dueDate || 'Non d√©finie' }}</td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <button
                    type="button"
                    class="btn btn-outline-primary"
                    (click)="startEdit(task)"
                    title="Modifier"
                  >
                    ‚úèÔ∏è
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-danger"
                    (click)="deleteTask(task.id)"
                    title="Supprimer"
                  >
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
